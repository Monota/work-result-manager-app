<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="layout">
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
<meta th:name="_csrf" th:content="${_csrf.token}"/>
<title>成果一覧</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
<script src="/js/jquery.hammer.js" th:src="@{/js/jquery.hammer.js}"></script>
<script th:inline="javascript">
$(document).ready(function(){
	$('tr').on('dblclick', function(event) {
		$('#createButton').hide();
		$('#editButton').show();
		$('#deleteButton').show();
		$('#workDate').prop('readonly', true);
		$('#itemTypeName').prop('readonly', true);
		$('#itemIsNew').prop('readonly', true);
		$('#itemUnitPrice').prop('readonly', true);
		$('#workDate').val($(this).find('td,th').eq(0).text());
		$('#itemTypeName').val($(this).find('td,th').eq(1).text());
		if ($(this).find('td,th').eq(2).text() == "○") {
			$('#itemIsNew').prop("checked", true);
		} else {
			$('#itemIsNew').prop("checked", false);
		}
		$('#itemUnitPrice').val($(this).find('td,th').eq(3).text());
		$('#itemQuantity').val($(this).find('td,th').eq(4).text());
		$('.ui.modal').modal('show');
	});
	$('tr').on('touchend', function(event) {
		e.preventDefault();
	}).hammer().bind('doubletap', function(event) {
		$('#createButton').hide();
		$('#editButton').show();
		$('#deleteButton').show();
		$('#workDate').prop('readonly', true);
		$('#itemTypeName').prop('readonly', true);
		$('#itemIsNew').prop('readonly', true);
		$('#itemUnitPrice').prop('readonly', true);
		$('#workDate').val($(this).find('td,th').eq(0).text());
		$('#itemTypeName').val($(this).find('td,th').eq(1).text());
		if ($(this).find('td,th').eq(2).text() == "○") {
			$('#itemIsNew').prop("checked", true);
		} else {
			$('#itemIsNew').prop("checked", false);
		}
		$('#itemUnitPrice').val($(this).find('td,th').eq(3).text());
		$('#itemQuantity').val($(this).find('td,th').eq(4).text());
		$('.ui.modal').modal('show');
	});
	$('#newItemButton').on('click', function(event) {
		$('#createButton').show();
		$('#editButton').hide();
		$('#deleteButton').hide();
		$('#workDate').prop('readonly', false);
		$('#itemTypeName').prop('readonly', false);
		$('#itemIsNew').prop('readonly', false);
		$('#itemUnitPrice').prop('readonly', false);
		$('#workDate').val('');
		$('#itemTypeName').val('');
		$('#itemIsNew').prop("checked", false);
		$('#itemUnitPrice').val('');
		$('#itemQuantity').val('');
		$('.ui.modal').modal('show');
	});
	$('#createButton').on('click', function(event) {
		$('#mode').val('new');
		$('#editForm').submit();
	});
	$('#editButton').on('click', function(event) {
		$('#mode').val('edit');
		$('#editForm').submit();
	});
	$('#deleteButton').on('click', function(event) {
		$('#mode').val('del');
		$('#editForm').submit();
	});
});
</script>
<style>
.container {
	margin-top: 30px;
}
.left-aligned {
	width: 50%;
	float: left;
	margin: 0;
	text-align: left;
}
.right-aligned {
	width: 50%;
	float: right;
	margin: 0;
}
</style>
</head>
<body>
	<div class="ui container">
		<row th:if="${Message} != null">
			<p class="ui positive message">完了しました。</p>
		</row>
		<row th:if="${ErrorMessage} != null">
			<p class="ui error message">
				入力エラーがあります。<br>画面から正しい値を入力してください。
			</p>
		</row>
	</div>
	<div class="ui container">
		<row>
			<button class="ui labeled icon positive button" id="newItemButton">
				<i class="edit icon"></i>追加
			</button>
		</row>
	</div>
	<div class="ui container">
		<row th:unless="${#lists.isEmpty(workItems)}">
			<table class="ui celled unstackable table">
				<thead>
					<tr>
						<th>日付</th>
						<th>種類</th>
						<th>新品</th>
						<th>単価</th>
						<th>数量</th>
						<th>小計</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="wi : ${workItems}">
						<td th:text="${#dates.format(wi.workDate,'yyyy-MM-dd')}">2018-04-01</td>
						<td th:text="${{wi.itemTypeName}}">テスト1</td>
						<td th:text="${{wi.itemIsNew}} ? '○' : ''">○</td>
						<td th:text="${{wi.itemUnitPrice}}">3.0</td>
						<td th:text="${{wi.itemQuantity}}">2</td>
						<td th:text="${{wi.itemUnitPrice}} * ${{wi.itemQuantity}}">6.0</td>
					</tr>
				</tbody>
			</table>
		</row>
	</div>
	</div>
	<div class="ui tiny modal">
		<i class="close icon"></i>
		<div class="header">編集</div>
		<div class="content">
			<form id="editForm" class="ui form" method="POST" action="/work/list/save" th:action="@{/work/list/save}" th:object="${workItemForm}">
				<div class="field">
					<label for="workDate">日付</label>
					<input type="text" class="ui input" id="workDate" th:field="*{workDate}" readonly="readonly" />
				</div>
				<div class="field">
					<label for="itemTypeName">種類</label>
					<input type="text" class="ui input" id="itemTypeName" th:field="*{itemTypeName}" readonly="readonly" />
				</div>
				<div class="field">
					<label for="itemIsNew">新品</label>
					<div class="ui toggle checkbox">
						<input type="checkbox" id="itemIsNew" th:field="*{itemIsNew}" readonly="readonly">
						<label>&nbsp;</label>
					</div>
				</div>
				<div class="field">
					<label for="itemUnitPrice">単価</label>
					<input type="text" class="ui input" id="itemUnitPrice" th:field="*{itemUnitPrice}" readonly="readonly" />
				</div>
				<div class="field">
					<label for="itemQuantity">数量</label>
					<input type="text" class="ui input" id="itemQuantity" th:field="*{itemQuantity}" />
				</div>
				<input type="hidden" id="mode" th:field="*{mode}" />
			</form>
		</div>
		<div class="actions">
			<div class="left-aligned">
				<div class="ui negative delete button" id="deleteButton"><i class="delete icon"></i>削除</div>
			</div>
			<div class="right-aligned">
				<div class="ui positive create button" id="createButton"><i class="edit icon"></i>作成</div>
				<div class="ui primary edit button" id="editButton"><i class="pencil alternate icon"></i>更新</div>
				<div class="ui cancel button">閉じる</div>
			</div>
			<div style="clear:both;"></div>
		</div>
	</div>
</body>
</html>
